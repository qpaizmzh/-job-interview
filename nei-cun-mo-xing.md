## 内存模型

## 地址空间的划分

* 内核空间
* 用户空间

## JVM内存模型-JDK8

* 线程私有：程序计数器、虚拟机栈、本地方法栈

  * ### 程序计数器（Program Counter Register）

    * 当前线程所执行的字节码指示器（逻辑）
    * 改变计数器的值来选取下一条需要执行的字节码指令
    * 和线程是一对一的关系即“线程私有”
    * 对Java方法技术，对native方法记为“undefined”
    * 不会发生内存泄漏
  * Java虚拟机栈（Stack）
    * Java方法执行的内存模型
    * 包含多个栈帧
    * 局部变量表和操作树栈的区别
      * 局部变量表：包含方法执行过程中的所有变量
      * 操作树栈：入栈、出栈、复制、交换、产生消费变量
      * ![](/模型/1.png)
      * ![](/assets/3.png)
      * 题外话：递归为什么会引发java.lang.StackoverflowError异常？
        * 递归过深，栈帧数超出虚拟栈深度，解决方法就是使用循环代替
      * 同样的一个虚拟机栈对应一个线程，如果虚拟机栈过多，线程过多并且没有足够的内存使用就会抛出内存溢出的异常

* 所有线程共享：MetaSpace,Java堆

  * 元空间（MetaSpace）和永久代（PermGen）的区别
    * 元空间使用本地内存，而永久代使用的是JVM的内存



