# cpu多级缓存

### 为什么需要CPU CACHE？

* CPU的频率太快，快到主存跟不上，这样在处理器的时钟周期内，CPU常常需要等待主存，浪费资源。所以cache的出现，是缓解CPU和内存间速度不匹配的问题

### CPU cache的意义：

* 时间局部性：如果数据被访问，可能在以后也会被访问

* 时间空间性：如果数据被访问，那么和它的相邻的数据也可能会被访问

### 缓存一致性--MESI\(Modify Exclusive Shared Invalid\)协议

* 缓存行：就是每个线程的本地缓存的基本单位，是主存和缓存数据交互的基本单位

* modified:这个状态是修改状态，是线程修改之后缓存在自己线程的本地内存，并没有写到主存，需要在某个时间点写回去，在这个时间点之前，允许其他的线程进行读取主存的数据，在把修改的数据写进去之后，缓存行就会把状态更改成exclusive

* exclusive:这个状态的缓存行只在该线程的本地内存（缓存）中，和主存的数据一致，这时如果有其他线程的数据要读取数据的话，状态就会更改成共享状态

* shared:就是这个缓存行会被多个线程进行缓存的状态，当有其他的线程要对缓存行进行修改的时候，当前缓存行就会变成M状态，而其他线程的缓存就会进入I状态

* Invalid：表明其它线程修改了缓存，此缓存行要作废



